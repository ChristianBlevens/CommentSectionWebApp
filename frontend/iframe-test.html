<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comment Section Iframe Test</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <script>
        // Add dynamic theme CSS link
        function loadThemeCSS() {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = '/api/theme.css';
            link.onerror = function() {
                console.log('Theme CSS not found, using defaults');
            };
            document.head.appendChild(link);
        }
        
        // Load theme CSS immediately
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadThemeCSS);
        } else {
            loadThemeCSS();
        }
    </script>
</head>
<body class="page-container">
    <div class="container mx-auto p-4 max-w-7xl">
        <!-- Header -->
        <div class="card p-6 mb-6">
            <h1 class="text-2xl font-bold mb-4">
                <i class="fas fa-code mr-2 text-primary"></i>
                Comment Section Iframe Test
            </h1>
            <p class="text-secondary mb-4">
                This page demonstrates multiple comment sections loaded via iframes, each with a different page ID.
                You can sign in once and interact with all comment sections independently.
            </p>
            <div class="bg-warning-light border-l-4 border-warning p-4">
                <p class="text-sm">
                    <strong>Note:</strong> Each iframe loads the comment section with a different pageId parameter.
                    Comments, votes, and reports are isolated per page.
                </p>
            </div>
        </div>
        
        <!-- Multiple article sections with embedded comments -->
        <div class="space-y-8">
            <!-- Article 1 -->
            <div class="card overflow-hidden">
                <div class="p-6">
                    <h2 class="text-xl font-bold mb-3">
                        <i class="fas fa-newspaper mr-2"></i>
                        Article 1: Introduction to Web Development
                    </h2>
                    <p class="text-secondary mb-4">
                        This is a sample article about web development basics. Lorem ipsum dolor sit amet, 
                        consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                    </p>
                    <p class="text-secondary mb-4">
                        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea 
                        commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum.
                    </p>
                </div>
                
                <!-- Comments Section for Article 1 -->
                <div class="border-t border-light">
                    <div class="p-4 bg-secondary">
                        <h3 class="font-semibold mb-2">Comments for Article 1</h3>
                    </div>
                    <iframe 
                        src="index.html?pageId=article-1" 
                        class="w-full"
                        style="height: 600px; border: none;"
                        title="Comments for Article 1">
                    </iframe>
                </div>
            </div>
            
            <!-- Article 2 -->
            <div class="card overflow-hidden">
                <div class="p-6">
                    <h2 class="text-xl font-bold mb-3">
                        <i class="fas fa-rocket mr-2"></i>
                        Article 2: Advanced JavaScript Techniques
                    </h2>
                    <p class="text-secondary mb-4">
                        Explore advanced JavaScript concepts and patterns. Lorem ipsum dolor sit amet, 
                        consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                    </p>
                    <p class="text-secondary mb-4">
                        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea 
                        commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum.
                    </p>
                </div>
                
                <!-- Comments Section for Article 2 -->
                <div class="border-t border-light">
                    <div class="p-4 bg-secondary">
                        <h3 class="font-semibold mb-2">Comments for Article 2</h3>
                    </div>
                    <iframe 
                        src="index.html?pageId=article-2" 
                        class="w-full"
                        style="height: 600px; border: none;"
                        title="Comments for Article 2">
                    </iframe>
                </div>
            </div>
            
            <!-- Article 3 -->
            <div class="card overflow-hidden">
                <div class="p-6">
                    <h2 class="text-xl font-bold mb-3">
                        <i class="fas fa-database mr-2"></i>
                        Article 3: Database Design Best Practices
                    </h2>
                    <p class="text-secondary mb-4">
                        Learn about database design principles and best practices. Lorem ipsum dolor sit amet, 
                        consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                    </p>
                    <p class="text-secondary mb-4">
                        Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea 
                        commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum.
                    </p>
                </div>
                
                <!-- Comments Section for Article 3 -->
                <div class="border-t border-light">
                    <div class="p-4 bg-secondary">
                        <h3 class="font-semibold mb-2">Comments for Article 3</h3>
                    </div>
                    <iframe 
                        src="index.html?pageId=article-3" 
                        class="w-full"
                        style="height: 600px; border: none;"
                        title="Comments for Article 3">
                    </iframe>
                </div>
            </div>
        </div>
        
        <!-- Test Information -->
        <div class="bg-info-light rounded-lg p-6 mt-8">
            <h3 class="font-semibold mb-3">
                <i class="fas fa-info-circle mr-2"></i>
                Testing Information
            </h3>
            <ul class="space-y-2 text-sm">
                <li>• Each comment section above is loaded in its own iframe with a unique pageId</li>
                <li>• Sign in with Discord in any comment section - the session is shared across all</li>
                <li>• Comments are isolated per pageId - they won't appear in other sections</li>
                <li>• Moderators can view reports specific to each page or use the global reports page</li>
                <li>• All features (voting, replying, deleting, reporting) work independently per section</li>
            </ul>
        </div>
        
        <!-- Quick Links -->
        <div class="card p-6 mt-6">
            <h3 class="font-semibold mb-3">
                <i class="fas fa-link mr-2"></i>
                Quick Links
            </h3>
            <div class="flex flex-wrap gap-4">
                <a href="index.html" class="text-primary hover:text-primary-hover">
                    <i class="fas fa-comments mr-1"></i>Main Comment Section
                </a>
                <a href="moderators.html" class="text-primary hover:text-primary-hover">
                    <i class="fas fa-shield-alt mr-1"></i>Moderator Management
                </a>
                <a href="reports.html" class="text-primary hover:text-primary-hover">
                    <i class="fas fa-flag mr-1"></i>Global Reports
                </a>
            </div>
        </div>
    </div>
    
    <script>
        // Resize iframes based on content
        window.addEventListener('message', function(e) {
            if (e.data && e.data.type === 'resize-iframe') {
                const iframe = document.querySelector(`iframe[src*="${e.data.pageId}"]`);
                if (iframe && e.data.height) {
                    iframe.style.height = (e.data.height + 50) + 'px';
                }
            }
        });
        
        // Optional: Auto-resize iframes periodically
        setInterval(() => {
            document.querySelectorAll('iframe').forEach(iframe => {
                try {
                    const height = iframe.contentWindow.document.body.scrollHeight;
                    iframe.style.height = (height + 50) + 'px';
                } catch (e) {
                    // Cross-origin, can't access
                }
            });
        }, 100);
    </script>
</body>
</html>